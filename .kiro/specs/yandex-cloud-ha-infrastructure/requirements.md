# Документ требований

## Введение

Данный проект направлен на создание отказоустойчивой инфраструктуры в Yandex Cloud с использованием Terraform. Система должна включать две виртуальные машины, объединенные в таргет-группу, и сетевой балансировщик нагрузки (NLB) с HTTP health-check для обеспечения высокой доступности веб-сервиса.

## Требования

### Требование 1

**История пользователя:** Как DevOps-инженер, я хочу автоматизированно создавать две идентичные виртуальные машины через Terraform, чтобы обеспечить резервирование вычислительного слоя.

#### Критерии успеха

1. КОГДА выполняю `terraform apply` ТОГДА система ДОЛЖНА создать 2 ВМ с одинаковыми параметрами в YC
2. КОГДА проверяю ресурсы в консоли YC ТОГДА система ДОЛЖНА показать обе ВМ в статусе RUNNING
3. КОГДА использую аргумент count ТОГДА Terraform ДОЛЖЕН создать идентичные ресурсы

### Требование 2

**История пользователя:** Как DevOps-инженер, я хочу объединить эти ВМ в таргет-группу для балансировщика, чтобы он знал, куда направлять трафик.

#### Критерии успеха

1. КОГДА создается таргет-группа ТОГДА система ДОЛЖНА включить обе ВМ в список targets
2. КОГДА изменяются IP ВМ ТОГДА изменения ДОЛЖНЫ автоматически отражаться в таргет-группе после `terraform apply`
3. КОГДА балансировщик обращается к таргет-группе ТОГДА он ДОЛЖЕН получить актуальный список целевых машин

### Требование 3

**История пользователя:** Как DevOps-инженер, я хочу создать сетевой балансировщик нагрузки (NLB), который слушает порт 80 и проверяет здоровье через HTTP, чтобы распределять трафик и отсекать неработающие инстансы.

#### Критерии успеха

1. КОГДА балансировщик создан ТОГДА его статус ДОЛЖЕН быть Active
2. КОГДА healthcheck запрашивает `/` на порт 80 ВМ ТОГДА обе ВМ ДОЛЖНЫ получить статус healthy
3. КОГДА балансировщик получает запрос на порт 80 ТОГДА он ДОЛЖЕН перенаправить трафик на порт 80 виртуальных машин
4. КОГДА одна из ВМ недоступна ТОГДА балансировщик ДОЛЖЕН исключить ее из ротации

### Требование 4

**История пользователя:** Как DevOps-инженер, я хочу, чтобы на каждой ВМ был установлен и запущен Nginx на порту 80, чтобы балансировщик мог отдавать HTTP-контент.

#### Критерии успеха

1. КОГДА подключаюсь к любой ВМ по SSH и выполняю `systemctl status nginx` ТОГДА система ДОЛЖНА показать active (running)
2. КОГДА выполняю `curl http://<PRIVATE_IP_VM>` ТОГДА система ДОЛЖНА вернуть дефолтную страницу Nginx
3. КОГДА ВМ запускается ТОГДА Nginx ДОЛЖЕН автоматически устанавливаться и запускаться через cloud-init

### Требование 5

**История пользователя:** Как пользователь, я хочу обращаться по публичному IP балансировщика и получать страницу Nginx без ошибок, чтобы убедиться в работоспособности кластера.

#### Критерии успеха

1. КОГДА выполняю `curl http://<PUBLIC_IP_NLB>` ТОГДА система ДОЛЖНА вернуть HTTP 200 и дефолтную страницу Nginx
2. КОГДА перезапускаю одну из ВМ ТОГДА балансировщик ДОЛЖЕН продолжать отдавать страницу, не прерывая сервис
3. КОГДА обращаюсь к балансировщику через браузер ТОГДА система ДОЛЖНА отобразить страницу Nginx

## Дополнительные требования и ограничения

- Terraform версии ≥ 1.0, провайдер `yandex` ≥ 0.95
- Используется один subnet/zone, если иное не указано
- ОС ВМ: Ubuntu 22.04 LTS (cloud-image)
- Доступ по SSH через публичный ключ пользователя
- Все переменные Terraform вынесены в `variables.tf` и `terraform.tfvars`
- Проект должен быть размещен в Git репозитории с соответствующей документацией