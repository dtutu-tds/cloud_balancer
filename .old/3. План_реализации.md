# План реализации

* **1. Подготовка локального окружения**

  * Установлен Terraform ≥ 1.0 (`terraform -v`)
  * Проверен OAuth‑токен Yandex Cloud (`yc iam token`)
  * *Основано на: чек‑лист готовности.*

* **2. Клонировать репозиторий‑шаблон**

  * `git clone https://github.com/<ваш_аккаунт>/sys-pattern-homework.git yc-ha-hw`
  * `cd yc-ha-hw`
  * *Основано на: инструкция к ДЗ.*

* **3. Создать структуру Terraform‑кода**

  * `touch main.tf variables.tf outputs.tf cloud-init.tpl terraform.tfvars`
  * Внести блоки по схеме из Документа проектирования.
  * *Основано на требованиях 1–5.*

* **4. Описать переменные (`variables.tf`)**

  * `instance_count` (по умолчанию — 2)
  * `yc_token`, `folder_id`, `zone`, `region`, `cidr`, `ssh_pub_key`, `project_name` и др.

* **5. Добавить cloud-init (`cloud-init.tpl`)**

  ```bash
  #cloud-config
  packages:
    - nginx
  runcmd:
    - systemctl enable --now nginx
  ```

  * *Требование 4.*

* **6. Описать ресурсы в `main.tf`**

  1. `provider "yandex"` с токеном.
  2. Сеть + подсеть + security‑group (HTTP/SSH).
  3. `yandex_compute_instance` с `count = var.instance_count`.
  4. `yandex_lb_target_group` (dynamic targets).
  5. `yandex_lb_network_load_balancer` с listener :80 и health‑check.

* **7. Определить выводы (`outputs.tf`)**

  * `nlb_public_ip` — публичный IP балансировщика.
  * `web_private_ips` — список внутренних IP ВМ.

* **8. Инициализировать Terraform**

  * `terraform init`

* **9. Просмотреть и применить план**

  * `terraform plan -out=tfplan`
  * `terraform apply tfplan`

* **10. Верифицировать в Yandex Cloud**

  * Балансировщик в статусе *Active*.
  * Обе ВМ *healthy* в целевой группе.

* **11. Проверить HTTP‑доступ**

  * `curl http://$(terraform output -raw nlb_public_ip)` → HTTP 200.
  * Сделать скриншот страницы Nginx в браузере.

* **12. Тест на отказоустойчивость**

  * `yc compute instance stop <web‑0>`.
  * Повторный `curl` к NLB — должен оставаться 200.
  * Запустить ВМ обратно.

* **13. Документировать результат**

  * Добавить скриншоты в README.md.
  * Коммит: `git add . && git commit -m "implement ha infra" && git push`.

* **14. Сдать работу**

  * Опубликовать ссылку на репозиторий в ЛК Нетологии.

> ⚙️  *Подсказка:* при изменении числа ВМ достаточно правки `instance_count` + `terraform apply` — весь цикл повторится без лишних блоков.
