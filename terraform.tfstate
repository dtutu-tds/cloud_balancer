{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 8,
  "lineage": "b2e03d24-3acb-fa32-84c2-662124dcb72d",
  "outputs": {
    "network_id": {
      "value": "enpcn1n13c8j8fevp22d",
      "type": "string"
    },
    "nlb_public_ip": {
      "value": "84.201.170.171",
      "type": "string"
    },
    "subnet_id": {
      "value": "e9b99cri6te23ulh7vga",
      "type": "string"
    },
    "target_group_id": {
      "value": "enpf50irotp4j9efudh9",
      "type": "string"
    },
    "web_private_ips": {
      "value": [
        "10.128.0.19",
        "10.128.0.16"
      ],
      "type": [
        "tuple",
        [
          "string",
          "string"
        ]
      ]
    },
    "web_public_ips": {
      "value": [
        "51.250.7.221",
        "84.201.156.241"
      ],
      "type": [
        "tuple",
        [
          "string",
          "string"
        ]
      ]
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "yandex_compute_image",
      "name": "ubuntu",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-07-28T11:05:43Z",
            "description": "Ubuntu 22.04 lts v20250718030543",
            "family": "ubuntu-2204-lts",
            "folder_id": "standard-images",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V2"
                  }
                ]
              }
            ],
            "id": "fd879eiad8tf5vhb3kbs",
            "image_id": "fd879eiad8tf5vhb3kbs",
            "kms_key_id": null,
            "labels": {
              "version": "20250718030543"
            },
            "min_disk_size": 8,
            "name": "ubuntu-22-04-lts-v20250728",
            "os_type": "linux",
            "pooled": true,
            "product_ids": [
              "f2et1t5vha46l60srg8s"
            ],
            "size": 2,
            "status": "ready"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_instance",
      "name": "web",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "fhmept7js5cfm45ns415",
                "disk_id": "fhmept7js5cfm45ns415",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd879eiad8tf5vhb3kbs",
                    "kms_key_id": "",
                    "name": "",
                    "size": 20,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-08-02T12:26:42Z",
            "description": "Веб-сервер 1 для ha-web проекта",
            "filesystem": [],
            "folder_id": "b1gc0k8akffl633ichr0",
            "fqdn": "fhm2pg84g904lmdeolhu.auto.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V2"
                  }
                ]
              }
            ],
            "hostname": "",
            "id": "fhm2pg84g904lmdeolhu",
            "labels": {
              "environment": "production",
              "instance": "1",
              "project": "ha-web",
              "role": "web-server"
            },
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL0lBEhu5C8EEhiS3jjtCvr5rjmilKgAoPuun++LKzFlPoWpZsB5H2aimLd0gRpCjjZeMWW4j2c+EDF7kwztrGHeArFroSiBygsqJ9+5qFd1vfUXSm04XvJyijN8CN49lzfSqErW5i2a3bP2KZLZh5HlDOKQ6LPRyA2SISTb64eOjRnFvfkXEMRZG+Z2lic0NwvkeFXbyQEJC+7oSD5FIJmGYmxMy5KqyF3uI64C3XZcmoykUcFxUfdUXOfL76IGBirbL3gWS10B8iaqUEEg09uwW62bGxpe5EOL7R8MRM5PvO6nAOjDplvULzOnVS+LmCOXo5J+cNx2ns721pVMnb tds@atlassian\n",
              "user-data": "#cloud-config\n\n# Обновление пакетов и установка Nginx\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - nginx\n  - curl\n\n# Команды для настройки Nginx\nruncmd:\n  # Включаем автоматический запуск Nginx при старте системы (требование 4.3)\n  - systemctl enable nginx\n  # Запускаем Nginx сразу после установки (требование 4.1)\n  - systemctl start nginx\n  # Настраиваем firewall для HTTP трафика\n  - ufw allow 'Nginx Full'\n  - ufw allow OpenSSH\n  # Создаем кастомную страницу с информацией о сервере (требование 4.2)\n  - 'echo \"\u003ch1\u003eNginx Server: $(hostname)\u003c/h1\u003e\u003cp\u003eServer started at: $(date)\u003c/p\u003e\u003cp\u003eThis server is part of HA infrastructure\u003c/p\u003e\" \u003e /var/www/html/index.html'\n  # Проверяем что Nginx запустился корректно\n  - 'systemctl is-active nginx || (echo \"ERROR: Nginx failed to start\" \u003e\u003e /var/log/cloud-init-output.log \u0026\u0026 exit 1)'\n  # Проверяем что Nginx отвечает на HTTP запросы\n  - 'sleep 5 \u0026\u0026 curl -f http://localhost/ || (echo \"ERROR: Nginx HTTP check failed\" \u003e\u003e /var/log/cloud-init-output.log \u0026\u0026 exit 1)'\n\n# Автоматический запуск Nginx настраивается через systemctl enable в runcmd\n\n# Логирование процесса инициализации\noutput:\n  all: \"\u003e\u003e /var/log/cloud-init-output.log\"\n\n# Финальное сообщение\nfinal_message: \"Cloud-init setup completed successfully. Nginx is running and ready to serve HTTP requests.\""
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "ha-web-web-1",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.128.0.19",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:2c:c1:04:82",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "51.250.7.221",
                "nat_ip_version": "IPV4",
                "security_group_ids": [
                  "enpc02rqvdteuprp8f24"
                ],
                "subnet_id": "e9b99cri6te23ulh7vga"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu",
            "yandex_vpc_network.main",
            "yandex_vpc_security_group.web",
            "yandex_vpc_subnet.public"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": null,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "fhmjne2c0b248lmufd5p",
                "disk_id": "fhmjne2c0b248lmufd5p",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd879eiad8tf5vhb3kbs",
                    "kms_key_id": "",
                    "name": "",
                    "size": 20,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-08-02T12:26:42Z",
            "description": "Веб-сервер 2 для ha-web проекта",
            "filesystem": [],
            "folder_id": "b1gc0k8akffl633ichr0",
            "fqdn": "fhm89le5i3h5eegd6f9t.auto.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V2"
                  }
                ]
              }
            ],
            "hostname": "",
            "id": "fhm89le5i3h5eegd6f9t",
            "labels": {
              "environment": "production",
              "instance": "2",
              "project": "ha-web",
              "role": "web-server"
            },
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "ssh-keys": "ubuntu:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL0lBEhu5C8EEhiS3jjtCvr5rjmilKgAoPuun++LKzFlPoWpZsB5H2aimLd0gRpCjjZeMWW4j2c+EDF7kwztrGHeArFroSiBygsqJ9+5qFd1vfUXSm04XvJyijN8CN49lzfSqErW5i2a3bP2KZLZh5HlDOKQ6LPRyA2SISTb64eOjRnFvfkXEMRZG+Z2lic0NwvkeFXbyQEJC+7oSD5FIJmGYmxMy5KqyF3uI64C3XZcmoykUcFxUfdUXOfL76IGBirbL3gWS10B8iaqUEEg09uwW62bGxpe5EOL7R8MRM5PvO6nAOjDplvULzOnVS+LmCOXo5J+cNx2ns721pVMnb tds@atlassian\n",
              "user-data": "#cloud-config\n\n# Обновление пакетов и установка Nginx\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - nginx\n  - curl\n\n# Команды для настройки Nginx\nruncmd:\n  # Включаем автоматический запуск Nginx при старте системы (требование 4.3)\n  - systemctl enable nginx\n  # Запускаем Nginx сразу после установки (требование 4.1)\n  - systemctl start nginx\n  # Настраиваем firewall для HTTP трафика\n  - ufw allow 'Nginx Full'\n  - ufw allow OpenSSH\n  # Создаем кастомную страницу с информацией о сервере (требование 4.2)\n  - 'echo \"\u003ch1\u003eNginx Server: $(hostname)\u003c/h1\u003e\u003cp\u003eServer started at: $(date)\u003c/p\u003e\u003cp\u003eThis server is part of HA infrastructure\u003c/p\u003e\" \u003e /var/www/html/index.html'\n  # Проверяем что Nginx запустился корректно\n  - 'systemctl is-active nginx || (echo \"ERROR: Nginx failed to start\" \u003e\u003e /var/log/cloud-init-output.log \u0026\u0026 exit 1)'\n  # Проверяем что Nginx отвечает на HTTP запросы\n  - 'sleep 5 \u0026\u0026 curl -f http://localhost/ || (echo \"ERROR: Nginx HTTP check failed\" \u003e\u003e /var/log/cloud-init-output.log \u0026\u0026 exit 1)'\n\n# Автоматический запуск Nginx настраивается через systemctl enable в runcmd\n\n# Логирование процесса инициализации\noutput:\n  all: \"\u003e\u003e /var/log/cloud-init-output.log\"\n\n# Финальное сообщение\nfinal_message: \"Cloud-init setup completed successfully. Nginx is running and ready to serve HTTP requests.\""
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "ha-web-web-2",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.128.0.16",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:84:d5:c5:90",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "84.201.156.241",
                "nat_ip_version": "IPV4",
                "security_group_ids": [
                  "enpc02rqvdteuprp8f24"
                ],
                "subnet_id": "e9b99cri6te23ulh7vga"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v1",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 2
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": false
              }
            ],
            "secondary_disk": [],
            "service_account_id": "",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "data.yandex_compute_image.ubuntu",
            "yandex_vpc_network.main",
            "yandex_vpc_security_group.web",
            "yandex_vpc_subnet.public"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_lb_network_load_balancer",
      "name": "nlb",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allow_zonal_shift": false,
            "attached_target_group": [
              {
                "healthcheck": [
                  {
                    "healthy_threshold": 2,
                    "http_options": [
                      {
                        "path": "/",
                        "port": 80
                      }
                    ],
                    "interval": 2,
                    "name": "http-health-check",
                    "tcp_options": [],
                    "timeout": 1,
                    "unhealthy_threshold": 2
                  }
                ],
                "target_group_id": "enpf50irotp4j9efudh9"
              }
            ],
            "created_at": "2025-08-02T12:27:52Z",
            "deletion_protection": false,
            "description": "Сетевой балансировщик нагрузки для ha-web проекта",
            "folder_id": "b1gc0k8akffl633ichr0",
            "id": "enpps4fip7igic9cmjfk",
            "labels": {
              "environment": "production",
              "project": "ha-web",
              "role": "network-load-balancer"
            },
            "listener": [
              {
                "external_address_spec": [
                  {
                    "address": "84.201.170.171",
                    "ip_version": "ipv4"
                  }
                ],
                "internal_address_spec": [],
                "name": "http-listener",
                "port": 80,
                "protocol": "tcp",
                "target_port": 80
              }
            ],
            "name": "ha-web-nlb",
            "region_id": "ru-central1",
            "timeouts": null,
            "type": "external"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.yandex_compute_image.ubuntu",
            "yandex_compute_instance.web",
            "yandex_lb_target_group.web",
            "yandex_vpc_network.main",
            "yandex_vpc_security_group.web",
            "yandex_vpc_subnet.public"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_lb_target_group",
      "name": "web",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-08-02T12:27:51Z",
            "description": "Таргет-группа для веб-серверов ha-web проекта",
            "folder_id": "b1gc0k8akffl633ichr0",
            "id": "enpf50irotp4j9efudh9",
            "labels": {
              "environment": "production",
              "project": "ha-web",
              "role": "load-balancer-target-group"
            },
            "name": "ha-web-target-group",
            "region_id": "ru-central1",
            "target": [
              {
                "address": "10.128.0.16",
                "subnet_id": "e9b99cri6te23ulh7vga"
              },
              {
                "address": "10.128.0.19",
                "subnet_id": "e9b99cri6te23ulh7vga"
              }
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.yandex_compute_image.ubuntu",
            "yandex_compute_instance.web",
            "yandex_vpc_network.main",
            "yandex_vpc_security_group.web",
            "yandex_vpc_subnet.public"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_network",
      "name": "main",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-08-02T12:26:37Z",
            "default_security_group_id": "enpgc9fgoltmgp9ffbrf",
            "description": "Основная сеть для ha-web проекта",
            "folder_id": "b1gc0k8akffl633ichr0",
            "id": "enpcn1n13c8j8fevp22d",
            "labels": {},
            "name": "ha-web-network",
            "subnet_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMCwiZGVsZXRlIjo2MDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_security_group",
      "name": "web",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-08-02T12:26:41Z",
            "description": "Группа безопасности для веб-серверов",
            "egress": [
              {
                "description": "All outbound traffic",
                "from_port": 0,
                "id": "enpgs2rdhr3jaih56qm4",
                "labels": {},
                "port": -1,
                "predefined_target": "",
                "protocol": "ANY",
                "security_group_id": "",
                "to_port": 65535,
                "v4_cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "v6_cidr_blocks": []
              }
            ],
            "folder_id": "b1gc0k8akffl633ichr0",
            "id": "enpc02rqvdteuprp8f24",
            "ingress": [
              {
                "description": "HTTP",
                "from_port": -1,
                "id": "enpvprdvk4fvucrrro9l",
                "labels": {},
                "port": 80,
                "predefined_target": "",
                "protocol": "TCP",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "v6_cidr_blocks": []
              },
              {
                "description": "SSH",
                "from_port": -1,
                "id": "enpqnn4848ioqvgkt70h",
                "labels": {},
                "port": 22,
                "predefined_target": "",
                "protocol": "TCP",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "v6_cidr_blocks": []
              }
            ],
            "labels": {},
            "name": "ha-web-security-group",
            "network_id": "enpcn1n13c8j8fevp22d",
            "status": "ACTIVE",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "yandex_vpc_network.main"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_subnet",
      "name": "public",
      "provider": "provider[\"local/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-08-02T12:26:40Z",
            "description": "Публичная подсеть для ha-web проекта",
            "dhcp_options": [],
            "folder_id": "b1gc0k8akffl633ichr0",
            "id": "e9b99cri6te23ulh7vga",
            "labels": {},
            "name": "ha-web-subnet",
            "network_id": "enpcn1n13c8j8fevp22d",
            "route_table_id": "",
            "timeouts": null,
            "v4_cidr_blocks": [
              "10.128.0.0/24"
            ],
            "v6_cidr_blocks": [],
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "yandex_vpc_network.main"
          ]
        }
      ]
    }
  ],
  "check_results": [
    {
      "object_kind": "var",
      "config_addr": "var.project_name",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.project_name",
          "status": "pass"
        }
      ]
    },
    {
      "object_kind": "var",
      "config_addr": "var.instance_count",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.instance_count",
          "status": "pass"
        }
      ]
    }
  ]
}
